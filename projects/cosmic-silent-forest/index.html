<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terrain Studio</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Top Bar -->
  <div id="topbar">
    <div id="topbar-left">
      <div id="logo">TERRAIN STUDIO</div>
      <div id="topbar-search">
        <input type="text" id="search-input" placeholder="Search any place..." autocomplete="off">
        <button id="search-btn" title="Search (Enter)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        </button>
        <div id="search-results" class="hidden"></div>
      </div>
    </div>
    <div id="topbar-center">
      <div id="hud">
        <span id="hud-coords" title="Cursor coordinates">--</span>
        <span class="hud-sep">|</span>
        <span id="hud-elev" title="Elevation at cursor">--</span>
        <span class="hud-sep">|</span>
        <span id="hud-slope" title="Slope at cursor">--</span>
      </div>
    </div>
    <div id="topbar-right">
      <button class="tb-btn" id="btn-screenshot" title="Screenshot (P)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="12" cy="13" r="4"/><path d="M5 3v-1h2"/></svg>
      </button>
      <button class="tb-btn" id="btn-fullscreen" title="Fullscreen (F)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>
      </button>
      <button class="tb-btn" id="btn-help" title="Keyboard Shortcuts (?)">?</button>
    </div>
  </div>

  <!-- Sidebar -->
  <div id="sidebar">

    <!-- Source Section -->
    <div class="panel">
      <div class="panel-header" data-panel="source">
        <span>Data Source</span>
        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 9l6 6 6-6"/></svg>
      </div>
      <div class="panel-body" id="panel-source">
        <div class="source-tabs">
          <button class="source-tab active" data-source="realworld">Real World</button>
          <button class="source-tab" data-source="procedural">Procedural</button>
        </div>

        <!-- Real World Controls -->
        <div id="source-realworld">
          <div class="ctrl">
            <label>Latitude</label>
            <input type="number" id="lat" value="46.85" step="0.01" min="-90" max="90">
          </div>
          <div class="ctrl">
            <label>Longitude</label>
            <input type="number" id="lng" value="8.30" step="0.01" min="-180" max="180">
          </div>
          <div class="ctrl">
            <label>Range (km): <span id="range-val">10</span></label>
            <input type="range" id="range" min="1" max="100" value="10">
          </div>
          <div class="ctrl">
            <label>Grid Density: <span id="density-val">40</span></label>
            <input type="range" id="density" min="10" max="120" value="40">
          </div>
          <div class="ctrl">
            <label>Elevation API</label>
            <select id="apiSource">
              <option value="auto">Auto (Open-Meteo / OpenTopo)</option>
              <option value="openmeteo">Open-Meteo (Copernicus 90m)</option>
              <option value="opentopodata">Open Topo Data (SRTM 90m)</option>
            </select>
          </div>
          <button id="generate" class="btn-primary">Generate Terrain</button>
        </div>

        <!-- Procedural Controls -->
        <div id="source-procedural" class="hidden">
          <div class="ctrl">
            <label>Seed: <span id="seed-val">42</span></label>
            <input type="number" id="proc-seed" value="42" min="0" max="99999">
          </div>
          <div class="ctrl">
            <label>Grid Size: <span id="proc-size-val">100</span></label>
            <input type="range" id="proc-size" min="20" max="200" value="100">
          </div>
          <div class="ctrl">
            <label>Octaves: <span id="proc-octaves-val">6</span></label>
            <input type="range" id="proc-octaves" min="1" max="10" value="6">
          </div>
          <div class="ctrl">
            <label>Frequency: <span id="proc-freq-val">2.0</span></label>
            <input type="range" id="proc-freq" min="0.5" max="8" value="2.0" step="0.1">
          </div>
          <div class="ctrl">
            <label>Lacunarity: <span id="proc-lac-val">2.0</span></label>
            <input type="range" id="proc-lac" min="1" max="4" value="2.0" step="0.1">
          </div>
          <div class="ctrl">
            <label>Persistence: <span id="proc-pers-val">0.5</span></label>
            <input type="range" id="proc-pers" min="0.1" max="0.9" value="0.5" step="0.05">
          </div>
          <div class="ctrl">
            <label>Terrain Type</label>
            <select id="proc-type">
              <option value="mountains">Mountains</option>
              <option value="islands">Islands</option>
              <option value="ridges">Ridged</option>
              <option value="plateaus">Plateaus</option>
              <option value="canyons">Canyons</option>
            </select>
          </div>
          <button id="generate-proc" class="btn-primary">Generate Procedural</button>
          <button id="randomize-proc" class="btn-secondary">Randomize</button>
        </div>
      </div>
    </div>

    <!-- Visual Section -->
    <div class="panel">
      <div class="panel-header" data-panel="visual">
        <span>Visual</span>
        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 9l6 6 6-6"/></svg>
      </div>
      <div class="panel-body" id="panel-visual">
        <div class="ctrl">
          <label>Vertical Scale: <span id="exag-val">1.5</span></label>
          <input type="range" id="exaggeration" min="0.5" max="10" value="1.5" step="0.1">
        </div>
        <div class="ctrl">
          <label>Color Scheme</label>
          <select id="colorScheme">
            <option value="terrain">Natural Terrain</option>
            <option value="satellite">Satellite</option>
            <option value="ocean">Deep Ocean</option>
            <option value="heat">Thermal</option>
            <option value="topographic">Topographic Map</option>
            <option value="arctic">Arctic</option>
            <option value="volcanic">Volcanic</option>
            <option value="neon">Neon Cyber</option>
            <option value="sunset">Sunset</option>
            <option value="grayscale">Grayscale</option>
          </select>
        </div>
        <div id="color-preview"></div>
        <div class="ctrl-row">
          <label class="check-label"><input type="checkbox" id="wireframe"> Wireframe</label>
          <label class="check-label"><input type="checkbox" id="flatShading"> Flat Shading</label>
        </div>
        <div class="ctrl-row">
          <label class="check-label"><input type="checkbox" id="show-water" checked> Water</label>
          <label class="check-label"><input type="checkbox" id="show-fog"> Fog</label>
        </div>
        <div class="ctrl" id="water-level-ctrl">
          <label>Water Level: <span id="water-val">0</span>%</label>
          <input type="range" id="water-level" min="0" max="80" value="0">
        </div>
        <div class="ctrl">
          <label>Sun Angle: <span id="sun-val">45</span>&deg;</label>
          <input type="range" id="sun-angle" min="0" max="360" value="45">
        </div>
        <div class="ctrl">
          <label>Sun Height: <span id="sun-height-val">60</span>&deg;</label>
          <input type="range" id="sun-height" min="5" max="90" value="60">
        </div>
      </div>
    </div>

    <!-- Analysis Section -->
    <div class="panel">
      <div class="panel-header" data-panel="analysis">
        <span>Analysis</span>
        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 9l6 6 6-6"/></svg>
      </div>
      <div class="panel-body" id="panel-analysis">
        <div class="ctrl">
          <label>Overlay</label>
          <select id="analysis-mode">
            <option value="none">None</option>
            <option value="slope">Slope Angle</option>
            <option value="aspect">Aspect (Direction)</option>
            <option value="contour">Contour Lines</option>
          </select>
        </div>
        <div class="ctrl" id="contour-interval-ctrl" style="display:none">
          <label>Contour Interval: <span id="contour-val">50</span>m</label>
          <input type="range" id="contour-interval" min="10" max="500" value="50" step="10">
        </div>
        <div class="ctrl">
          <label>Cross-Section Tool</label>
          <button id="btn-profile" class="btn-secondary">Draw Profile Line</button>
          <div id="profile-hint" class="hint hidden">Click two points on terrain</div>
        </div>
        <div id="stats-box" class="hidden">
          <div class="stat-row"><span>Min Elevation</span><span id="stat-min">--</span></div>
          <div class="stat-row"><span>Max Elevation</span><span id="stat-max">--</span></div>
          <div class="stat-row"><span>Elevation Range</span><span id="stat-range">--</span></div>
          <div class="stat-row"><span>Mean Elevation</span><span id="stat-mean">--</span></div>
          <div class="stat-row"><span>Grid Points</span><span id="stat-points">--</span></div>
        </div>
      </div>
    </div>

    <!-- Export Section -->
    <div class="panel">
      <div class="panel-header" data-panel="export">
        <span>Export</span>
        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 9l6 6 6-6"/></svg>
      </div>
      <div class="panel-body" id="panel-export">
        <button class="btn-export" id="export-png">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
          Screenshot (PNG)
        </button>
        <button class="btn-export" id="export-heightmap">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 15h18"/><path d="M3 9h18"/></svg>
          Heightmap Image
        </button>
        <button class="btn-export" id="export-stl">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
          3D Print (STL)
        </button>
        <button class="btn-export" id="export-raw">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
          Raw Data (JSON)
        </button>
      </div>
    </div>

    <!-- Presets Section -->
    <div class="panel">
      <div class="panel-header" data-panel="presets">
        <span>Presets</span>
        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 9l6 6 6-6"/></svg>
      </div>
      <div class="panel-body" id="panel-presets">
        <div class="preset-grid">
          <button class="preset" data-lat="46.85" data-lng="8.30" data-range="30">Swiss Alps</button>
          <button class="preset" data-lat="36.07" data-lng="-112.14" data-range="20">Grand Canyon</button>
          <button class="preset" data-lat="27.99" data-lng="86.93" data-range="40">Mt. Everest</button>
          <button class="preset" data-lat="35.36" data-lng="138.73" data-range="25">Mt. Fuji</button>
          <button class="preset" data-lat="37.75" data-lng="-119.57" data-range="30">Yosemite</button>
          <button class="preset" data-lat="-3.07" data-lng="37.35" data-range="30">Kilimanjaro</button>
          <button class="preset" data-lat="64.01" data-lng="-16.67" data-range="30">Iceland Highlands</button>
          <button class="preset" data-lat="-13.16" data-lng="-72.54" data-range="20">Machu Picchu</button>
          <button class="preset" data-lat="44.43" data-lng="6.85" data-range="20">French Alps</button>
          <button class="preset" data-lat="36.25" data-lng="-116.83" data-range="15">Death Valley</button>
          <button class="preset" data-lat="-43.59" data-lng="170.14" data-range="30">NZ Southern Alps</button>
          <button class="preset" data-lat="19.47" data-lng="-155.59" data-range="25">Big Island Hawaii</button>
        </div>
      </div>
    </div>

    <!-- Camera Section -->
    <div class="panel">
      <div class="panel-header" data-panel="camera">
        <span>Camera</span>
        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 9l6 6 6-6"/></svg>
      </div>
      <div class="panel-body collapsed" id="panel-camera">
        <button class="btn-secondary" id="btn-top-view">Top View</button>
        <button class="btn-secondary" id="btn-side-view">Side View</button>
        <button class="btn-secondary" id="btn-angle-view">3/4 View</button>
        <button class="btn-secondary" id="btn-flythrough">Fly Through</button>
        <div class="ctrl">
          <label>Fly Speed: <span id="fly-speed-val">1.0</span>x</label>
          <input type="range" id="fly-speed" min="0.2" max="5" value="1" step="0.1">
        </div>
      </div>
    </div>

    <div id="status"></div>
  </div>

  <!-- Canvas Container -->
  <div id="canvas-container"></div>

  <!-- Elevation Profile Panel -->
  <div id="profile-panel" class="hidden">
    <div id="profile-header">
      <strong>Elevation Profile</strong>
      <button id="profile-close">X</button>
    </div>
    <canvas id="profile-canvas" width="800" height="200"></canvas>
  </div>

  <!-- Loading Overlay -->
  <div id="loading" class="hidden">
    <div class="spinner"></div>
    <p id="loading-text">Fetching elevation data...</p>
    <button id="loading-cancel" class="btn-secondary">Cancel</button>
  </div>

  <!-- Keyboard Help Modal -->
  <div id="help-modal" class="hidden">
    <div id="help-content">
      <h3>Keyboard Shortcuts</h3>
      <div class="shortcut-grid">
        <div class="shortcut"><kbd>G</kbd> Generate terrain</div>
        <div class="shortcut"><kbd>R</kbd> Randomize procedural</div>
        <div class="shortcut"><kbd>P</kbd> Screenshot</div>
        <div class="shortcut"><kbd>F</kbd> Toggle fullscreen</div>
        <div class="shortcut"><kbd>W</kbd> Toggle wireframe</div>
        <div class="shortcut"><kbd>C</kbd> Cycle color schemes</div>
        <div class="shortcut"><kbd>1</kbd> Top view</div>
        <div class="shortcut"><kbd>2</kbd> Side view</div>
        <div class="shortcut"><kbd>3</kbd> 3/4 view</div>
        <div class="shortcut"><kbd>Space</kbd> Fly through</div>
        <div class="shortcut"><kbd>+/-</kbd> Vertical scale</div>
        <div class="shortcut"><kbd>Tab</kbd> Toggle sidebar</div>
        <div class="shortcut"><kbd>Esc</kbd> Close panels</div>
        <div class="shortcut"><kbd>?</kbd> This help</div>
      </div>
      <button id="help-close" class="btn-primary">Got it</button>
    </div>
  </div>

  <!-- Debug Panel -->
  <div id="debug-panel" class="hidden">
    <div id="debug-header">
      <strong>Debug Log</strong>
      <div>
        <button id="debug-copy">Copy</button>
        <button id="debug-close">X</button>
      </div>
    </div>
    <pre id="debug-content"></pre>
  </div>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/"
    }
  }
  </script>
  <script type="module" src="app.js"></script>
</body>
</html>
